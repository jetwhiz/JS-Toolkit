/* https://github.com/jetwhiz/JS-Toolkit: 2015-10-12 */
"use strict";var DragDropVars={mouseOffset:null,isMouseDown:!1,prevMouseState:!1,dragContainerSets:[],curTarget:null,dragHoverBox:null,rootParent:null,rootSibling:null,themePlain:"",themeAlt:""},DragDrop={init:function(r,e){DragDropVars.themePlain=r,DragDropVars.themeAlt=e,EventManager.attachEvent(document,"mouseup",DragDrop.mouseUp),EventManager.attachEvent(document,"mousemove",DragDrop.mouseMove),EventManager.attachEvent(document,"touchmove",DragDrop.mouseMove)},addContainerSet:function(r){var e=DragDropVars.dragContainerSets.length;DragDropVars.dragContainerSets[e]=[];for(var t=0;t<r.length;++t){var a=r[t];DragDropVars.dragContainerSets[e].push(a);for(var o=0;o<a.childNodes.length;++o)1===a.childNodes[o].nodeType&&(EventManager.attachEvent(a.childNodes[o],"mousedown",DragDrop.mouseDown),EventManager.attachEvent(a.childNodes[o],"touchstart",DragDrop.mouseDown),a.childNodes[o].setAttribute("ContainerSetIndex",e))}},getMouseOffset:function(r,e){e||(e=window.event);var t=DragDrop.getElementPosition(r),a=DragDrop.getMouseCoords(e);return{x:a.x-t.x,y:a.y-t.y}},getElementPosition:function(r){for(var e=0,t=0;r.offsetParent;)e+=r.offsetLeft,t+=r.offsetTop,r=r.offsetParent;return e+=r.offsetLeft,t+=r.offsetTop,{x:e,y:t}},getMouseCoords:function(r){return r.pageX||r.pageY?{x:r.pageX,y:r.pageY}:{x:r.clientX+document.body.scrollLeft+document.documentElement.clientLeft,y:r.clientY+document.body.scrollTop+document.documentElement.clientTop}},mouseMove:function(r){r||(r=window.event);var e;r.target?e=r.target:r.srcElement&&(e=r.srcElement);for(var t=e;null!==t&&(1!=t.nodeType||DragDrop.isNotDraggable(t)&&"body"!=t.nodeName.toLowerCase()&&"html"!=t.nodeName.toLowerCase());)t=t.parentNode;if(null!==t){var a=DragDrop.getMouseCoords(r),o=t.getAttribute("ContainerSetIndex");if(null!==o&&DragDropVars.isMouseDown&&!DragDropVars.prevMouseState){DragDropVars.curTarget=t,DragDropVars.rootParent=DragDropVars.curTarget.parentNode,DragDropVars.rootSibling=DragDropVars.curTarget.nextElementSibling,DragDropVars.mouseOffset=DragDrop.getMouseOffset(e,r);for(var s=0;s<DragDropVars.dragHoverBox.childNodes.length;++s)DragDropVars.dragHoverBox.removeChild(DragDropVars.dragHoverBox.childNodes[s]);DragDropVars.dragHoverBox.appendChild(DragDropVars.curTarget.cloneNode(!0)),DragDropVars.dragHoverBox.style.display="block",DragDropVars.dragHoverBox.firstElementChild.removeAttribute("ContainerSetIndex"),DragDropVars.curTarget.setAttribute("startWidth",parseInt(DragDropVars.curTarget.offsetWidth,10)),DragDropVars.curTarget.setAttribute("startHeight",parseInt(DragDropVars.curTarget.offsetHeight,10)),DragDropVars.curTarget.setAttribute("startBGColor",DragDropVars.curTarget.style.backgroundColor),DragDropVars.curTarget.style.backgroundColor="#dfffdf";for(var n=DragDropVars.dragContainerSets[o],g=0;g<n.length;++g){var i=DragDrop.getElementPosition(n[g]);n[g].setAttribute("startWidth",parseInt(n[g].offsetWidth,10)),n[g].setAttribute("startHeight",parseInt(n[g].offsetHeight,10)),n[g].setAttribute("startLeft",i.x),n[g].setAttribute("startTop",i.y);for(var D=0;D<n[g].childNodes.length;++D){var l=n[g].childNodes[D];1!==l.nodeType||l==DragDropVars.curTarget||DragDrop.isNotDraggable(l)||(i=DragDrop.getElementPosition(l),l.setAttribute("startWidth",parseInt(l.offsetWidth,10)),l.setAttribute("startHeight",parseInt(l.offsetHeight,10)),l.setAttribute("startLeft",i.x),l.setAttribute("startTop",i.y))}}}if(DragDropVars.curTarget){DragDropVars.dragHoverBox.style.top=a.y-DragDropVars.mouseOffset.y+"px",DragDropVars.dragHoverBox.style.left=a.x-DragDropVars.mouseOffset.x+"px";for(var d=DragDropVars.curTarget.getAttribute("ContainerSetIndex"),n=DragDropVars.dragContainerSets[d],p=null,u=a.x-DragDropVars.mouseOffset.x+DragDropVars.curTarget.getAttribute("startWidth")/4,c=a.y-DragDropVars.mouseOffset.y+DragDropVars.curTarget.getAttribute("startHeight")/4,s=n.length-1;s>=0;--s){var f=parseInt(n[s].getAttribute("startLeft"),10),h=f+parseInt(n[s].getAttribute("startWidth"),10),m=parseInt(n[s].getAttribute("startTop"),10),v=m+parseInt(n[s].getAttribute("startHeight"),10);if(u>f&&c>m&&h>u&&v>c){p=n[s];break}}if(p){for(var V=null,s=p.childNodes.length-1;s>=0;--s){var b=p.childNodes[s];if(1==b.nodeType&&!DragDrop.isNotDraggable(b)){var h=parseInt(b.getAttribute("startLeft"),10)+parseInt(b.getAttribute("startWidth"),10),v=parseInt(b.getAttribute("startTop"),10)+parseInt(b.getAttribute("startHeight"),10);DragDropVars.curTarget!=b&&h>u&&v>c&&(V=b)}}if(V)V!=DragDropVars.curTarget.nextElementSibling&&p.insertBefore(DragDropVars.curTarget,V);else if(DragDropVars.curTarget.nextElementSibling||DragDropVars.curTarget.parentNode!=p){for(var N=null,s=p.childNodes.length-1;s>=0;--s)if(1==p.childNodes[s].nodeType&&!DragDrop.isNotDraggable(p.childNodes[s])){N=p.childNodes[s];break}N&&N.nextSibling?p.insertBefore(DragDropVars.curTarget,N.nextSibling):p.appendChild(DragDropVars.curTarget)}}else DragDropVars.rootSibling?DragDropVars.rootParent.insertBefore(DragDropVars.curTarget,DragDropVars.rootSibling):DragDropVars.rootParent.appendChild(DragDropVars.curTarget)}return DragDropVars.prevMouseState=DragDropVars.isMouseDown,DragDropVars.curTarget?(r.preventDefault&&r.preventDefault(),r.cancelBubble=!0,!1):void 0}},mouseUp:function(){if(DragDropVars.curTarget){DragDropVars.dragHoverBox.style.display="none";for(var r=0;r<DragDropVars.dragHoverBox.childNodes.length;++r)DragDropVars.dragHoverBox.removeChild(DragDropVars.dragHoverBox.childNodes[r]);DragDropVars.curTarget.style.backgroundColor=DragDropVars.curTarget.getAttribute("startBGColor"),DragDrop.recolorList(DragDropVars.curTarget.parentNode)}DragDropVars.curTarget=null,DragDropVars.isMouseDown=!1},recolorList:function(r){for(var e=DragDropVars.themePlain,t=0;t<r.childNodes.length;++t){var a=r.childNodes[t];1!=a.nodeType||DragDrop.isNotDraggable(a)||(a.className=a.className.replace(DragDropVars.themePlain,e),a.className=a.className.replace(DragDropVars.themeAlt,e),e=e==DragDropVars.themePlain?DragDropVars.themeAlt:DragDropVars.themePlain)}},mouseDown:function(r){r||(r=window.event);var e;for(r.target?e=r.target:r.srcElement&&(e=r.srcElement);DragDrop.isNotDraggable(e)&&"body"!=e.nodeName.toLowerCase()&&"html"!=e.nodeName.toLowerCase();)e=e.parentNode;return DragDrop.isNotDraggable(e)?void 0:(DragDropVars.isMouseDown=!0,r.cancelBubble=!0,!1)},isNotDraggable:function(r){return-1==r.className.indexOf("jse_draggable")},serializeContainer:function(r){var e=[];if("function"!=typeof json_parse)return alert("serializeContainer: json_parse is required for this operation!"),null;if(1!=r.nodeType)return alert("serializeContainer: Invalid container given!"),null;for(var t=0;t<r.childNodes.length;++t){var a=r.childNodes[t],o={data:null,children:[]};if(1==a.nodeType&&-1!=a.className.indexOf("jse_draggable")){for(var s=0;s<a.childNodes.length;++s){var n=a.childNodes[s];if(1==n.nodeType&&-1!=n.className.indexOf("jse_data")){var g=json_parse(n.innerHTML);o.data=g;break}}for(var i=document.getElementsByClassName("jse_dragContainer",null,a),s=0;s<i.length;++s){for(var D=i[s].parentNode;-1==D.className.indexOf("jse_dragContainer")&&"body"!=D.nodeName.toLowerCase()&&"html"!=D.nodeName.toLowerCase();)D=D.parentNode;if(1==D.nodeType&&-1!=D.className.indexOf("jse_dragContainer")&&D==r){var l=DragDrop.serializeContainer(i[s]);l.length>0&&o.children.push(l)}}e.push(o)}}return e}};EventManager.addLoadEvent(function(){DragDrop.init("moduleRowPlain","moduleRowHighlight");for(var r=document.getElementsByClassName("jse_dragContainer"),e=0;e<r.length;++e)DragDrop.addContainerSet([r[e]]);DragDropVars.dragHoverBox=document.createElement("div"),DragDropVars.dragHoverBox.style.cssText="position:absolute;display:none;z-index:100;border:1px dashed #aaaaaa;",DragDropVars.dragHoverBox.className="genericDenseList moduleRow moduleRowPlain",document.body.appendChild(DragDropVars.dragHoverBox)});